# ASI – Cloud Security Management System
A MySQL + Streamlit Based Mini-Project

## 1. Overview
The **ASI (Automated Security Insights)** system enables tracking and management of cloud assets, exposures, vulnerabilities, patches, deployments, alerts, and incidents across multiple cloud providers.

This project includes:

- Database design and schema (DDL)
- DML with CRUD operations
- Advanced SQL (aggregates, joins, nested queries)
- Triggers, stored procedures, and functions
- A multi-page Streamlit GUI to demonstrate and manage the system

---

## 2. Features

### Database Features
- Relational database with referential integrity
- CRUD operations for all main entities
- Automated alert creation via triggers
- Stored functions and procedures for repeatable logic
- Advanced SQL for analytics and insights

### Streamlit GUI Features
- One page per table with Add, Update, Delete and View operations
- Read-only Alerts page (populated by triggers)
- Analytical pages:
  - Aggregate Functions
  - Join Queries (Inner, Left, Right, Multi-Join)
  - Nested Queries
- Overview dashboard with key indicators and charts

---

## 3. Data Model

### Entities
- `CLOUD_ACCOUNT` – Cloud accounts
- `ASSET` – Cloud assets/resources
- `EXPOSURE` – Exposed services/ports per asset
- `VULNERABILITY` – Vulnerabilities per asset
- `PATCH` – Patch details for each vulnerability
- `PATCH_DEPLOYMENT` – Deployment status of patches
- `ALERT` – Alerts generated by triggers or system actions
- `INCIDENT` – Incidents raised based on alerts

### Relationships
- One cloud account → many assets
- One asset → many exposures and vulnerabilities
- One vulnerability → one patch
- One patch → multiple deployments
- CRUD on selected tables produces new alerts via triggers

---

## 4. Database Schema (DDL)
Highlights:
- Primary keys with `AUTO_INCREMENT`
- Foreign key constraints
- `ENUM` fields for defined status and severity levels
- Timestamps with default values

The full schema is included in `sql_script.sql`.

---

## 5. DML and CRUD Operations
Implemented for all primary tables using SQL and through the Streamlit GUI:

- Insert new records
- Edit/update existing records
- Delete records
- View table contents

Alerts are never modified directly; they are auto-generated by triggers.

---

## 6. Triggers, Functions, and Procedures

### Triggers
Triggers automatically insert alert records into the `ALERT` table when CRUD activities occur on:

| Table               | Events                   | Trigger Purpose                                |
|---------------------|---------------------------|-------------------------------------------------|
| `VULNERABILITY`     | INSERT, UPDATE, DELETE    | Creates vulnerability-based alerts              |
| `EXPOSURE`          | INSERT, UPDATE, DELETE    | Logs changes in exposure                        |
| `PATCH`             | INSERT, UPDATE, DELETE    | Logs patch availability and updates             |
| `PATCH_DEPLOYMENT`  | INSERT, UPDATE, DELETE    | Logs deployment progress or failures            |

### Stored Procedures
| Procedure                                | Description                                     |
|-------------------------------------------|-------------------------------------------------|
| `sp_get_critical_vulns()`                 | Returns all critical vulnerabilities             |
| `sp_get_assets_by_provider(provider)`     | Lists all assets for a selected provider         |

### Stored Functions
| Function                                      | Returns                                      |
|------------------------------------------------|-----------------------------------------------|
| `fn_total_vulnerabilities()`                   | Count of vulnerabilities                      |
| `fn_get_asset_name(asset_id)`                  | Asset name for the given asset ID             |

---

## 7. Advanced SQL Queries

The project includes:

- Aggregate queries (COUNT, AVG, MIN/MAX, GROUP BY, HAVING)
- Joins
  - Inner Join
  - Left Join
  - Right Join
  - Multi-table joins linking 4+ tables
- Nested and correlated subqueries using:
  - `IN`
  - `EXISTS`
  - Subquery inside `HAVING`
  - Top-N queries

All these queries are available in separate Streamlit pages for demonstration.

---

## 8. Streamlit Application Layout
The project uses Streamlit's built-in multipage routing (any python file inside `pages/` is rendered as a page). Pages are prefixed with numbers to keep them in a logical order.

| Page | File | Purpose |
|------|------|---------|
| Overview Dashboard | `app.py` | KPIs, time-series charts, risk table, recent alerts |
| 1 – Cloud Account | `pages/1_Cloud_Account.py` | CRUD for cloud providers/accounts |
| 2 – Asset | `pages/2_Asset.py` | CRUD for assets mapped to cloud accounts |
| 3 – Vulnerability | `pages/3_Vulnerability.py` | Manage CVE data per asset (triggers fire alerts) |
| 4 – Exposure | `pages/4_Exposure.py` | Manage open ports/services per asset (triggers fire alerts) |
| 5 – Patch | `pages/5_Patch.py` | Track which patches remediate each vulnerability |
| 6 – Patch Deployment | `pages/6_Patch_Deployment.py` | Record deployment attempts and statuses |
| 7 – Alert | `pages/7_Alert.py` | Read-only feed of alerts created by triggers |
| 8 – Incident | `pages/8_Incident.py` | Link alerts to incidents and update their lifecycle |
| 9 – SQL Queries | `pages/9_SQL_Queries.py` | Single page that mixes joins, aggregates, nested queries |
| 10 – Aggregate Functions | `pages/10_Aggregate_Functions.py` | Drop-down driven demos of COUNT/AVG/MIN/MAX queries |
| 11 – Join Queries | `pages/11_Join_Queries.py` | Interactive INNER/LEFT/RIGHT/multi-join explorer |
| 12 – Nested Queries | `pages/12_Nested_Queries.py` | Examples using `IN`, `HAVING`, `EXISTS`, and Top-N subqueries |
| 13 – Functions & Procedures | `pages/13_Functions_Procedures.py` | Execute stored procedures/functions with inputs |
| 14 – Users | `pages/14_Users.py` | MySQL account management (create, grant, revoke, drop) |

---

## 9. Setup & Requirements

### 9.1 Prerequisites
- Python 3.9+ (Streamlit officially supports 3.8–3.12)
- MySQL Server 8.x (or compatible) with a database named `asi`
- MySQL user with permissions to create tables, triggers, procedures, and functions
- `pip` for installing Python dependencies

### 9.2 Install Python Dependencies
```bash
python3 -m venv .venv
source .venv/bin/activate
pip install --upgrade pip
pip install streamlit pandas pymysql
```
Create a `requirements.txt` later if you want to freeze versions for deployment/classmates.

### 9.3 Prepare the Database
1. Start MySQL and create the schema:
   ```sql
   CREATE DATABASE IF NOT EXISTS asi;
   USE asi;
   ```
2. Run the provided DDL/DML script (see `sql_script.sql`) to create tables, insert seed data, triggers, stored procedures, and functions.
3. Verify that triggers exist on `VULNERABILITY`, `EXPOSURE`, `PATCH`, and `PATCH_DEPLOYMENT` by running `SHOW TRIGGERS LIKE '%';`.

### 9.4 Configure the Connection
- Update `db.py` with your MySQL host, username, password, and database.
- For a cleaner setup you can load these values from environment variables or Streamlit's `.streamlit/secrets.toml`. (The code currently reads the constants directly, so adjust as needed before sharing the project.)

---

## 10. Running the Application
From the project root (with your virtual environment active):

```bash
streamlit run app.py
```

Streamlit will open `app.py` as the landing page and expose the multipage navigation in the sidebar. Keep the terminal running; any code change triggers hot-reload.

---

## 11. Suggested Demo Flow
1. **Cloud Account → Asset** – Create a provider, then register a few assets tied to that account.
2. **Exposure + Vulnerability** – Add exposures and CVE entries; note that triggers instantly create alert rows.
3. **Patch → Patch Deployment** – Link vulnerabilities to patches and mark deployments as Planned/In Progress/Completed.
4. **Incident Handling** – Open the Incident page to associate alerts with incidents and change their status.
5. **Analytics Pages** – Use Aggregate/Join/Nested pages to showcase SQL knowledge, then walk through stored procedures/functions.
6. **User Management** – (Optional, requires admin rights) demonstrate creating a limited MySQL user and granting privileges from `pages/14_Users.py`.
7. **Dashboard Review** – Return to the overview dashboard to show KPIs, charts, and the recent alerts table updating live.

---

## 12. Troubleshooting & Tips
- **Cannot connect to MySQL**: Ensure the credentials in `db.py` match your server and that MySQL is listening on `localhost:3306` (or update the host/port). Use `mysql -u root -p -h localhost asi` to confirm access.
- **Triggers did not fire**: Confirm the database actually contains the triggers and that your MySQL user has `TRIGGER` privileges. Running the DDL script again usually re-creates them.
- **Stored procedures/functions missing**: Re-run the relevant `CREATE PROCEDURE/FUNCTION` statements or check `INFORMATION_SCHEMA.ROUTINES`.
- **Permission errors on Users page**: Only accounts with `CREATE USER`/`GRANT OPTION` can use `pages/14_Users.py`. Log in as an admin user or hide the page for non-admin demos.
- **Streamlit cannot find pages**: Ensure every file in `pages/` uses the `N_Description.py` naming convention; Streamlit sorts by the numeric prefix.
- **Deployment**: For Heroku/Streamlit Cloud, replace the hard-coded credentials with environment-based secrets and allow inbound traffic to your MySQL instance.
